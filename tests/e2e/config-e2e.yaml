# Eneru E2E Test Configuration
# This configuration is used for end-to-end testing with the Docker Compose environment

ups:
  name: "TestUPS@localhost:3493"
  check_interval: 1
  max_stale_data_tolerance: 3

triggers:
  low_battery_threshold: 20
  critical_runtime_threshold: 600
  depletion:
    window: 300
    critical_rate: 15.0
    grace_period: 30  # Shorter for testing
  extended_time:
    enabled: false  # Disabled to avoid test timeouts

behavior:
  dry_run: false  # Real execution for E2E tests

logging:
  file: null  # Log to stdout only
  state_file: "/tmp/eneru-e2e-state"
  battery_history_file: "/tmp/eneru-e2e-history"
  shutdown_flag_file: "/tmp/eneru-e2e-shutdown-flag"

notifications:
  enabled: false  # Will be enabled via separate config when testing notifications
  urls: []

virtual_machines:
  enabled: false  # Skip for E2E (no libvirt in CI)

containers:
  enabled: true
  runtime: docker
  stop_timeout: 10  # Shorter for testing
  compose_files: []
  # NOTE: Must be false for E2E tests - setting to true would stop the NUT server
  # container (eneru-e2e-nut), causing connection loss and failsafe (FSB) trigger
  shutdown_all_remaining_containers: false

filesystems:
  sync_enabled: true
  unmount:
    enabled: true
    timeout: 5
    mounts:
      - path: "/tmp/eneru-e2e-tmpfs"
        options: ""

remote_servers:
  - name: "E2E SSH Target"
    enabled: true
    host: "localhost"
    user: "testuser"
    connect_timeout: 5
    command_timeout: 10
    shutdown_command: "sudo shutdown -h now"
    ssh_options:
      - "-o Port=2222"
      - "-o StrictHostKeyChecking=no"
      - "-o UserKnownHostsFile=/dev/null"
      - "-o IdentityFile=/tmp/e2e-ssh-key"

local_shutdown:
  enabled: false  # CRITICAL: Never enable in CI - would kill the runner!
  command: "echo 'Local shutdown would execute here'"
